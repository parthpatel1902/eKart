<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orders</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

<div class="container mt-5">
  <table class="table table-responsive">
    <thead>
      <tr>
        <th>No</th>
        <th>Person Name</th>
        <th>Order Status</th>
        <th>Amount</th>
        <th>Payment Mode</th>
        <th>Order Date</th>
        <th>Action</th>
        <th>Receipt</th>
        <th>Invoice</th>
      </tr>
    </thead>
    <tbody id="ordersTableBody">
      <!-- Data will be inserted here dynamically -->
    </tbody>
  </table>
</div>

<!-- Bootstrap Modal for displaying cart details -->
<div class="modal fade" id="cartModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Cart Details</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>No</th>
              <th>Product Image</th>
              <th>Product Name</th>
              <th>Category Name</th>
              <th>Price</th>
              <th>Quantity</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody id="cartDetailsBody">
            <!-- Cart details will be inserted here dynamically -->
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
  
  var ordersData = [
  {
            "_id": "664448064d02b19a61a698b7",
            "order_personName": "parth",
            "order_personId": "663b0cdd67f2365b58d2b78d",
            "cartId": [
                {
                    "_id": "664447924d02b19a61a69899",
                    "productName": "chair",
                    "categoryName": "home appliances",
                    "price": 1920,
                    "quantity": 1,
                    "product_picture": "chairs-pexels-eric-mufasa-578798-1350789.jpg"
                },
                {
                    "_id": "664447974d02b19a61a698a1",
                    "productName": "sofa",
                    "categoryName": "furniture",
                    "price": 8360,
                    "quantity": 1,
                    "product_picture": "sofa-pexels-pixabay-276583.jpg"
                }
            ],
            "AddressId": "663c5d3a8399d58b5ba2ac2a",
            "paymentMode": "Online",
            "amount": 10280,
            "order_status": "Pending",
            "receipt_url": "https://pay.stripe.com/receipts/payment/CAcaFwoVYWNjdF8xUDN6ejFHbVowVGFUU3Z1KIaQkbIGMgZBw9ACc0M6LBYvqllV6YyburmcGmSyWExuWi2HsEaulAHWgsdZAaZWlqC_JI0BLyEO34gR",
            "isDelete": false,
            "order_date": "2024-05-15T05:28:38.526Z",
            "__v": 0
        },
        {
            "_id": "664448844d02b19a61a698d0",
            "order_personName": "parth",
            "order_personId": "663b0cdd67f2365b58d2b78d",
            "cartId": [
                {
                    "_id": "664448414d02b19a61a698c0",
                    "productName": "sofa",
                    "categoryName": "furniture",
                    "price": 8360,
                    "quantity": 1,
                    "product_picture": "sofa-pexels-pixabay-276583.jpg"
                }
            ],
            "AddressId": "663c5d3a8399d58b5ba2ac2a",
            "paymentMode": "COD",
            "amount": 8360,
            "order_status": "Pending",
            "receipt_url": "",
            "isDelete": false,
            "order_date": "2024-05-15T05:30:44.213Z",
            "__v": 0
        },
        {
            "_id": "664497049b24c38767c96e04",
            "order_personName": "parth",
            "order_personId": "663b0cdd67f2365b58d2b78d",
            "cartId": [
                {
                    "_id": "664489bbf8a1bd22966cd5ed",
                    "productName": "chair",
                    "categoryName": "home appliances",
                    "price": 1920,
                    "quantity": 1,
                    "product_picture": "chairs-pexels-eric-mufasa-578798-1350789.jpg"
                },
                {
                    "_id": "664496c89b24c38767c96de1",
                    "productName": "kitchen table",
                    "categoryName": "furniture",
                    "price": 11040,
                    "quantity": 1,
                    "product_picture": "kitchen table-pexels-curtis-adams-1694007-12119357.jpg"
                },
                {
                    "_id": "664496ca9b24c38767c96de4",
                    "productName": "cake",
                    "categoryName": "food",
                    "price": 67.9,
                    "quantity": 1,
                    "product_picture": "cake-pexels-abhinavcoca-291528.jpg"
                },
                {
                    "_id": "664496cd9b24c38767c96de8",
                    "productName": "Asus Laptop",
                    "categoryName": "electronic",
                    "price": 49297.6,
                    "quantity": 2,
                    "product_picture": "Asus Laptop-pexels-morningtrain-18105.jpg"
                },
                {
                    "_id": "664496cf9b24c38767c96deb",
                    "productName": "book stand",
                    "categoryName": "home appliances",
                    "price": 5096,
                    "quantity": 1,
                    "product_picture": "book stand-pexels-zhuhehuai-683929.jpg"
                },
                {
                    "_id": "664496d39b24c38767c96dee",
                    "productName": "veg burger",
                    "categoryName": "food",
                    "price": 242.5,
                    "quantity": 3,
                    "product_picture": "veg burger-pexels-robinstickel-70497.jpg"
                },
                {
                    "_id": "664496d49b24c38767c96df1",
                    "productName": "garlic bread",
                    "categoryName": "food",
                    "price": 215.6,
                    "quantity": 2,
                    "product_picture": "garlic bread-pexels-mariana-kurnyk-844465-1775043.jpg"
                },
                {
                    "_id": "664496d89b24c38767c96df5",
                    "productName": "home theater",
                    "categoryName": "electronic",
                    "price": 2134,
                    "quantity": 1,
                    "product_picture": "home theater-pexels-monstera-1173651.jpg"
                }
            ],
            "AddressId": "664458b040116cacbcf9282b",
            "paymentMode": "COD",
            "amount": 120011.79999999999,
            "order_status": "Pending",
            "receipt_url": "",
            "isDelete": false,
            "order_date": "2024-05-15T11:05:40.356Z",
            "__v": 0
        }
  ];


  function displayOrders() {
    var ordersTableBody = document.getElementById('ordersTableBody');
    ordersTableBody.innerHTML = '';

    ordersData.forEach(function(order, index) {
      var orderDate = formatDate(order.order_date);
      var row = `<>
                  <td>${index + 1}</td>
                  <td>${order.order_personName}</td>
                  <td>${order.order_status}</td>
                  <td>₹${(order.amount).toFixed(2)}</td>
                  <td>${order.paymentMode}</td>
                  <td>${orderDate}</td>
                  <td> <button class="btn btn-primary" onclick="viewCart('${order._id}')">View Cart</button> </td>
                  `
                  row += `<td><a class="btn btn-dark" href='/invoice?id=${order._id}'><i class="bi bi-box-arrow-in-down"></i> Invoice</a></td>`
                 if(order.receipt_url != ''){
                   row+=` <td><a class="btn btn-dark" href='/transactionReceipt?id=${order._id}'><i class="bi bi-file-earmark-text"></i> Receipt</a></td>`
                 }else{
                  row+=`<td></td>`;
                 }

                row+=`</tr>`;
              
      ordersTableBody.innerHTML += row;
    });
  }

  // Function to view cart details in modal
  function viewCart(orderId) {
    var order = ordersData.find(function(order) {
      return order._id === orderId;
    });

    var cartDetailsBody = document.getElementById('cartDetailsBody');
    cartDetailsBody.innerHTML = '';

    let no = 1;
    order.cartId.forEach(function(item) {
      var subtotal = item.price * item.quantity;
      var row = `<tr>
                  <td>${no++}</td>
                  <td><img src="http://localhost:9999/${item.product_picture}" alt="Product Image" style="max-width: 100px;"></td>
                  <td>${item.productName}</td>
                  <td>${item.categoryName}</td>
                  <td>₹${item.price}</td>
                  <td>${item.quantity}</td>
                  <td>₹${subtotal}</td>
                </tr>`;
      cartDetailsBody.innerHTML += row;
    });

    $('#cartModal').modal('show');
  }

  // Function to format date
  function formatDate(dateString) {
    var date = new Date(dateString);
    var formattedDate = date.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
    var formattedTime = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });

    return formattedDate + ' ' + formattedTime;
  }

  // Display orders when the page loads
  displayOrders();
</script>

</body>
</html>
